<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Upload a Picture</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
    <div class="container">
        <h1>Upload a Picture</h1>

        <!-- Upload Form -->
        <form id="upload-form" enctype="multipart/form-data">
            <input type="file" name="file" accept="image/*" class="file-input" required>
            <button type="button" onclick="uploadFile()" class="upload-button">Upload</button>
        </form>

        <!-- Progress Bar for Upload -->
        <div id="progress-container" class="progress-container" style="display: none;">
            <div id="progress-bar" class="progress-bar"></div>
        </div>
    </div>

    <script>
        function uploadFile() {
            const fileInput = document.querySelector('input[type="file"]');
            if (!fileInput.files.length) return alert("Please select a file to upload.");

            const formData = new FormData();
            formData.append('file', fileInput.files[0]);

            const xhr = new XMLHttpRequest();
            xhr.open('POST', '/', true);

            // Show the progress bar
            document.getElementById('progress-container').style.display = 'block';

            // Update progress bar during the upload
            xhr.upload.onprogress = function (event) {
                if (event.lengthComputable) {
                    const percentComplete = (event.loaded / event.total) * 100;
                    document.getElementById('progress-bar').style.width = percentComplete + '%';
                }
            };

            // Redirect to the uploaded file page after successful upload
            xhr.onload = function () {
                if (xhr.status === 200) {
                    window.location.href = xhr.responseURL;
                } else {
                    alert("Upload failed. Please try again.");
                }
            };

            xhr.send(formData);
        }
    </script>
</body>

</html>